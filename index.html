<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Workout Timer</title>
    <style>
        :root {
            --sf-pro: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            --ios-blue: #007AFF;
            --ios-light-blue: #5AC8FA;
            --ios-gray: #8E8E93;
            --ios-light-gray: #F2F2F7;
            --ios-dark: #1C1C1E;
            --ios-card: #FFFFFF;
            --ios-green: #34C759;
            --ios-red: #FF3B30;
            --ios-orange: #FF9500;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--sf-pro);
            background: var(--ios-light-gray);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 0.5px solid rgba(0, 0, 0, 0.1);
            padding: 12px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 100%;
        }

        .header-title {
            font-size: 17px;
            font-weight: 600;
            color: var(--ios-dark);
            letter-spacing: -0.4px;
        }

        .header-button {
            background: none;
            border: none;
            color: var(--ios-blue);
            font-size: 17px;
            font-weight: 400;
            cursor: pointer;
            padding: 4px 0;
        }

        .header-button:active {
            opacity: 0.4;
        }

        /* Container */
        .container {
            max-width: 428px;
            margin: 0 auto;
            padding: 0;
            min-height: calc(100vh - 50px);
            display: flex;
            flex-direction: column;
        }

        /* Home Screen */
        .home-screen {
            padding: 20px;
            flex: 1;
        }

        .workout-card {
            background: var(--ios-card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .workout-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .workout-card-title {
            font-size: 17px;
            font-weight: 600;
            color: var(--ios-dark);
        }

        .workout-card-info {
            font-size: 13px;
            color: var(--ios-gray);
            margin-bottom: 12px;
        }

        .workout-card-actions {
            display: flex;
            gap: 8px;
        }

        .btn-ios {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-ios:active {
            opacity: 0.6;
            transform: scale(0.98);
        }

        .btn-primary-ios {
            background: var(--ios-blue);
            color: white;
        }

        .btn-secondary-ios {
            background: var(--ios-light-gray);
            color: var(--ios-blue);
        }

        .btn-danger-ios {
            background: var(--ios-light-gray);
            color: var(--ios-red);
        }

        .add-workout-btn {
            width: 100%;
            padding: 16px;
            background: var(--ios-card);
            border: 2px dashed var(--ios-blue);
            border-radius: 12px;
            color: var(--ios-blue);
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* Workout Builder */
        .builder-screen {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        .form-group {
            background: var(--ios-card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--ios-gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            display: block;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: none;
            background: var(--ios-light-gray);
            border-radius: 8px;
            font-size: 17px;
            font-family: var(--sf-pro);
            color: var(--ios-dark);
        }

        .form-input:focus {
            outline: none;
            background: #E8E8ED;
        }

        .toggle-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
        }

        .toggle-label {
            font-size: 17px;
            color: var(--ios-dark);
        }

        .toggle-switch {
            position: relative;
            width: 51px;
            height: 31px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #E9E9EA;
            transition: 0.3s;
            border-radius: 31px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 27px;
            width: 27px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        input:checked + .toggle-slider {
            background-color: var(--ios-green);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        .exercise-item {
            background: var(--ios-light-gray);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exercise-info {
            flex: 1;
        }

        .exercise-name {
            font-size: 17px;
            font-weight: 600;
            color: var(--ios-dark);
            margin-bottom: 4px;
        }

        .exercise-details {
            font-size: 13px;
            color: var(--ios-gray);
        }

        .delete-btn {
            background: var(--ios-red);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }

        /* Workout Screen */
        .workout-screen {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 50px);
            padding: 16px;
            padding-bottom: 20px;
        }

        .progress-section {
            background: var(--ios-card);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 12px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .progress-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--ios-gray);
        }

        .progress-percentage {
            font-size: 15px;
            font-weight: 600;
            color: var(--ios-blue);
        }

        .progress-bar-container {
            height: 4px;
            background: var(--ios-light-gray);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--ios-blue);
            transition: width 0.3s ease;
            width: 0%;
        }

        .exercise-card {
            background: var(--ios-card);
            border-radius: 12px;
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .exercise-header {
            text-align: center;
        }

        .section-badge {
            display: inline-block;
            padding: 4px 12px;
            background: var(--ios-light-gray);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            color: var(--ios-blue);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .exercise-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--ios-dark);
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .exercise-subtitle {
            font-size: 17px;
            color: var(--ios-gray);
            margin-bottom: 20px;
        }

        .timer-container {
            text-align: center;
            margin: 20px 0;
        }

        .timer-display {
            font-size: 72px;
            font-weight: 700;
            color: var(--ios-dark);
            font-variant-numeric: tabular-nums;
            letter-spacing: -2px;
        }

        .rhythm-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }

        .rhythm-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--ios-light-gray);
            color: var(--ios-gray);
        }

        .rhythm-circle.up {
            background: var(--ios-blue);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
        }

        .rhythm-circle.down {
            background: var(--ios-light-gray);
            color: var(--ios-gray);
            transform: scale(0.95);
        }

        .rep-counter {
            font-size: 17px;
            font-weight: 600;
            color: var(--ios-blue);
            margin-top: 16px;
        }

        .motivation-text {
            text-align: center;
            font-size: 15px;
            font-weight: 600;
            color: var(--ios-gray);
            margin: 12px 0;
        }

        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding-top: 12px;
        }

        .control-buttons.single {
            grid-template-columns: 1fr;
        }

        .control-btn {
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .btn-start {
            background: var(--ios-blue);
            color: white;
            grid-column: 1 / -1;
        }

        .btn-pause {
            background: var(--ios-orange);
            color: white;
        }

        .btn-skip {
            background: var(--ios-light-gray);
            color: var(--ios-blue);
        }

        /* Completion Screen */
        .completion-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: calc(100vh - 50px);
            padding: 20px;
            text-align: center;
        }

        .completion-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 1s ease-in-out infinite;
        }

        .completion-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--ios-dark);
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .completion-message {
            font-size: 17px;
            color: var(--ios-gray);
            margin-bottom: 24px;
        }

        .stats-card {
            background: var(--ios-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            width: 100%;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 0.5px solid var(--ios-light-gray);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 17px;
            color: var(--ios-dark);
        }

        .stat-value {
            font-size: 17px;
            font-weight: 600;
            color: var(--ios-blue);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: flex-end;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .modal {
            background: var(--ios-card);
            border-radius: 12px 12px 0 0;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 0.5px solid var(--ios-light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 17px;
            font-weight: 600;
            color: var(--ios-dark);
        }

        .modal-content {
            padding: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .hidden {
            display: none !important;
        }

        /* iOS-style number input */
        .number-input-group {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 12px;
            align-items: center;
            background: var(--ios-light-gray);
            border-radius: 8px;
            padding: 8px;
        }

        .number-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--ios-card);
            color: var(--ios-blue);
            font-size: 24px;
            font-weight: 400;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .number-btn:active {
            background: #E8E8ED;
        }

        .number-display {
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            color: var(--ios-dark);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <button class="header-button" id="backBtn" onclick="goBack()">‚Üê Back</button>
            <h1 class="header-title" id="headerTitle">Workouts</h1>
            <button class="header-button" id="editBtn" onclick="toggleEdit()">Edit</button>
        </div>
    </div>

    <div class="container">
        <!-- Home Screen -->
        <div id="homeScreen" class="home-screen">
            <div id="workoutsList"></div>
            <button class="add-workout-btn" onclick="showBuilder()">
                <span>+</span> Create Custom Workout
            </button>
        </div>

        <!-- Workout Builder Screen -->
        <div id="builderScreen" class="builder-screen hidden">
            <div class="form-group">
                <label class="form-label">Workout Name</label>
                <input type="text" class="form-input" id="workoutName" placeholder="My Custom Workout">
            </div>

            <div class="form-group">
                <label class="form-label">Settings</label>
                <div class="toggle-group">
                    <span class="toggle-label">Timer</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="timerToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="toggle-group">
                    <span class="toggle-label">Rhythm Guide</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="rhythmToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Exercises</label>
                <div id="exercisesList"></div>
                <button class="btn-ios btn-primary-ios" onclick="showExerciseModal()" style="margin-top: 12px; width: 100%;">
                    + Add Exercise
                </button>
            </div>

            <button class="btn-ios btn-primary-ios" onclick="saveWorkout()" style="margin-top: 12px; width: 100%;">
                Save Workout
            </button>
        </div>

        <!-- Workout Screen -->
        <div id="workoutScreen" class="workout-screen hidden">
            <div class="progress-section">
                <div class="progress-info">
                    <span class="progress-label">Progress</span>
                    <span class="progress-percentage" id="progressPercentage">0%</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>

            <div class="exercise-card">
                <div class="exercise-header">
                    <div class="section-badge" id="sectionBadge">Warm-up</div>
                    <h2 class="exercise-title" id="exerciseTitle">Bodyweight Squats</h2>
                    <p class="exercise-subtitle" id="exerciseSubtitle">15 reps</p>
                </div>

                <div class="timer-container">
                    <div class="timer-display" id="timerDisplay">0:45</div>
                    <div class="motivation-text" id="motivationText">üí™ You've got this!</div>
                </div>

                <div class="rhythm-container" id="rhythmContainer">
                    <div class="rhythm-circle" id="rhythmCircle">READY</div>
                    <div class="rep-counter" id="repCounter">Rep 0 / 15</div>
                </div>

                <div class="control-buttons single" id="controlButtons">
                    <button class="control-btn btn-start" id="startBtn" onclick="startExercise()">Start</button>
                </div>
            </div>
        </div>

        <!-- Completion Screen -->
        <div id="completionScreen" class="completion-screen hidden">
            <div class="completion-icon">üéâ</div>
            <h2 class="completion-title">Workout Complete!</h2>
            <p class="completion-message">Amazing work! You crushed it!</p>
            
            <div class="stats-card">
                <div class="stat-row">
                    <span class="stat-label">Time</span>
                    <span class="stat-value" id="totalTime">20 min</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Exercises</span>
                    <span class="stat-value" id="totalExercises">32</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Completion</span>
                    <span class="stat-value">100%</span>
                </div>
            </div>

            <button class="btn-ios btn-primary-ios" onclick="goHome()" style="width: 100%;">Done</button>
        </div>
    </div>

    <!-- Exercise Modal -->
    <div id="exerciseModal" class="modal-overlay hidden" onclick="closeExerciseModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">Add Exercise</h3>
                <button class="header-button" onclick="closeExerciseModal()">Cancel</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label class="form-label">Exercise Name</label>
                    <input type="text" class="form-input" id="exerciseNameInput" placeholder="Push-ups">
                </div>

                <div class="form-group">
                    <label class="form-label">Type</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button class="btn-ios btn-primary-ios" id="repsTypeBtn" onclick="setExerciseType('reps')">Reps</button>
                        <button class="btn-ios btn-secondary-ios" id="durationTypeBtn" onclick="setExerciseType('duration')">Duration</button>
                    </div>
                </div>

                <div class="form-group" id="repsGroup">
                    <label class="form-label">Number of Reps</label>
                    <div class="number-input-group">
                        <button class="number-btn" onclick="adjustNumber('reps', -1)">‚àí</button>
                        <div class="number-display" id="repsDisplay">10</div>
                        <button class="number-btn" onclick="adjustNumber('reps', 1)">+</button>
                    </div>
                </div>

                <div class="form-group hidden" id="durationGroup">
                    <label class="form-label">Duration (seconds)</label>
                    <div class="number-input-group">
                        <button class="number-btn" onclick="adjustNumber('duration', -5)">‚àí</button>
                        <div class="number-display" id="durationDisplay">30</div>
                        <button class="number-btn" onclick="adjustNumber('duration', 5)">+</button>
                    </div>
                </div>

                <div class="form-group" id="setsGroup">
                    <label class="form-label">Sets</label>
                    <div class="number-input-group">
                        <button class="number-btn" onclick="adjustNumber('sets', -1)">‚àí</button>
                        <div class="number-display" id="setsDisplay">3</div>
                        <button class="number-btn" onclick="adjustNumber('sets', 1)">+</button>
                    </div>
                </div>

                <div class="form-group" id="paceGroup">
                    <label class="form-label">Pace (seconds per rep)</label>
                    <div class="number-input-group">
                        <button class="number-btn" onclick="adjustNumber('pace', -1)">‚àí</button>
                        <div class="number-display" id="paceDisplay">3</div>
                        <button class="number-btn" onclick="adjustNumber('pace', 1)">+</button>
                    </div>
                </div>

                <button class="btn-ios btn-primary-ios" onclick="addExercise()" style="width: 100%; margin-top: 12px;">
                    Add Exercise
                </button>
            </div>
        </div>
    </div>

    <script>
        // Default workout data
        const defaultWorkout = {
            id: 'default',
            name: 'Full-Body Muscle Routine',
            timerEnabled: true,
            rhythmEnabled: true,
            exercises: [
                // Warm-up
                { section: "Warm-up", name: "Bodyweight Squats", reps: 15, pace: 3, type: "reps" },
                { section: "Warm-up", name: "Arm Circles", duration: 30, type: "duration" },
                { section: "Warm-up", name: "March in Place / Jumping Jacks", duration: 60, type: "duration" },
                { section: "Warm-up", name: "Hip Circles", duration: 30, type: "duration" },
                
                // Main Exercises - Set 1
                { section: "Main Workout - Set 1", name: "Squats", reps: 15, pace: 3, sets: 3, currentSet: 1, type: "reps" },
                { section: "Main Workout - Set 1", name: "Push-ups", reps: 12, pace: 3, sets: 3, currentSet: 1, type: "reps" },
                { section: "Main Workout - Set 1", name: "Glute Bridges", reps: 15, pace: 3, sets: 3, currentSet: 1, type: "reps" },
                { section: "Main Workout - Set 1", name: "Chair Dips", reps: 12, pace: 3, sets: 3, currentSet: 1, type: "reps" },
                { section: "Main Workout - Set 1", name: "Reverse Lunges", reps: 10, pace: 3, sets: 3, currentSet: 1, type: "reps" },
                { section: "Main Workout - Set 1", name: "Plank", duration: 30, sets: 3, currentSet: 1, type: "duration" },
                
                // Set 2
                { section: "Main Workout - Set 2", name: "Squats", reps: 15, pace: 3, sets: 3, currentSet: 2, type: "reps" },
                { section: "Main Workout - Set 2", name: "Push-ups", reps: 12, pace: 3, sets: 3, currentSet: 2, type: "reps" },
                { section: "Main Workout - Set 2", name: "Glute Bridges", reps: 15, pace: 3, sets: 3, currentSet: 2, type: "reps" },
                { section: "Main Workout - Set 2", name: "Chair Dips", reps: 12, pace: 3, sets: 3, currentSet: 2, type: "reps" },
                { section: "Main Workout - Set 2", name: "Reverse Lunges", reps: 10, pace: 3, sets: 3, currentSet: 2, type: "reps" },
                { section: "Main Workout - Set 2", name: "Plank", duration: 30, sets: 3, currentSet: 2, type: "duration" },
                
                // Set 3
                { section: "Main Workout - Set 3", name: "Squats", reps: 15, pace: 3, sets: 3, currentSet: 3, type: "reps" },
                { section: "Main Workout - Set 3", name: "Push-ups", reps: 12, pace: 3, sets: 3, currentSet: 3, type: "reps" },
                { section: "Main Workout - Set 3", name: "Glute Bridges", reps: 15, pace: 3, sets: 3, currentSet: 3, type: "reps" },
                { section: "Main Workout - Set 3", name: "Chair Dips", reps: 12, pace: 3, sets: 3, currentSet: 3, type: "reps" },
                { section: "Main Workout - Set 3", name: "Reverse Lunges", reps: 10, pace: 3, sets: 3, currentSet: 3, type: "reps" },
                { section: "Main Workout - Set 3", name: "Plank", duration: 30, sets: 3, currentSet: 3, type: "duration" },
                
                // Cool down
                { section: "Cool Down", name: "Quad Stretch", duration: 30, type: "duration" },
                { section: "Cool Down", name: "Quad Stretch (Other Leg)", duration: 30, type: "duration" },
                { section: "Cool Down", name: "Hamstring Stretch", duration: 30, type: "duration" },
                { section: "Cool Down", name: "Hamstring Stretch (Other Leg)", duration: 30, type: "duration" },
                { section: "Cool Down", name: "Glute Stretch", duration: 30, type: "duration" },
                { section: "Cool Down", name: "Glute Stretch (Other Leg)", duration: 30, type: "duration" },
                { section: "Cool Down", name: "Chest & Shoulder Stretch", duration: 30, type: "duration" },
                { section: "Cool Down", name: "Deep Breathing", duration: 60, type: "duration" }
            ]
        };

        // State management
        let workouts = [];
        let currentWorkout = null;
        let currentExerciseIndex = 0;
        let timer = null;
        let timeRemaining = 0;
        let currentRep = 0;
        let isUp = false;
        let isPaused = false;
        let editMode = false;
        let currentScreen = 'home';
        let builderExercises = [];
        let exerciseType = 'reps';
        let exerciseNumbers = { reps: 10, duration: 30, sets: 3, pace: 3 };

        const motivationalMessages = [
            "üí™ You've got this!",
            "üî• Keep pushing!",
            "‚ö° Feel the burn!",
            "üåü Almost there!",
            "üíØ Great form!",
            "üöÄ Strong work!",
            "‚ú® Amazing effort!",
            "üéØ Stay focused!",
            "üí• Power through!",
            "üèÜ You're crushing it!"
        ];

        // Initialize
        function init() {
            loadWorkouts();
            renderWorkoutsList();
            updateHeader();
        }

        // Load workouts from localStorage
        function loadWorkouts() {
            const saved = localStorage.getItem('workouts');
            if (saved) {
                workouts = JSON.parse(saved);
            } else {
                workouts = [defaultWorkout];
                saveWorkouts();
            }
        }

        // Save workouts to localStorage
        function saveWorkouts() {
            localStorage.setItem('workouts', JSON.stringify(workouts));
        }

        // Render workouts list
        function renderWorkoutsList() {
            const list = document.getElementById('workoutsList');
            list.innerHTML = '';
            
            workouts.forEach((workout, index) => {
                const totalTime = calculateWorkoutTime(workout);
                const card = document.createElement('div');
                card.className = 'workout-card';
                card.innerHTML = `
                    <div class="workout-card-header">
                        <div class="workout-card-title">${workout.name}</div>
                    </div>
                    <div class="workout-card-info">
                        ${workout.exercises.length} exercises ¬∑ ~${totalTime} min
                    </div>
                    <div class="workout-card-actions">
                        <button class="btn-ios btn-primary-ios" onclick="startWorkout(${index})">Start</button>
                        ${workout.id !== 'default' ? `
                            <button class="btn-ios btn-secondary-ios" onclick="editWorkout(${index})">Edit</button>
                            <button class="btn-ios btn-danger-ios" onclick="deleteWorkout(${index})">Delete</button>
                        ` : ''}
                    </div>
                `;
                list.appendChild(card);
            });
        }

        // Calculate workout time
        function calculateWorkoutTime(workout) {
            let total = 0;
            workout.exercises.forEach(ex => {
                if (ex.type === 'reps') {
                    total += ex.reps * (ex.pace || 3);
                } else {
                    total += ex.duration;
                }
            });
            return Math.round(total / 60);
        }

        // Navigation
        function updateHeader() {
            const backBtn = document.getElementById('backBtn');
            const editBtn = document.getElementById('editBtn');
            const headerTitle = document.getElementById('headerTitle');
            
            if (currentScreen === 'home') {
                backBtn.style.visibility = 'hidden';
                editBtn.style.visibility = 'hidden';
                headerTitle.textContent = 'Workouts';
            } else if (currentScreen === 'builder') {
                backBtn.style.visibility = 'visible';
                editBtn.style.visibility = 'hidden';
                headerTitle.textContent = 'Create Workout';
            } else if (currentScreen === 'workout') {
                backBtn.style.visibility = 'visible';
                editBtn.style.visibility = 'hidden';
                headerTitle.textContent = currentWorkout.name;
            } else if (currentScreen === 'completion') {
                backBtn.style.visibility = 'hidden';
                editBtn.style.visibility = 'hidden';
                headerTitle.textContent = 'Complete';
            }
        }

        function showScreen(screen) {
            document.getElementById('homeScreen').classList.add('hidden');
            document.getElementById('builderScreen').classList.add('hidden');
            document.getElementById('workoutScreen').classList.add('hidden');
            document.getElementById('completionScreen').classList.add('hidden');
            
            currentScreen = screen;
            document.getElementById(screen + 'Screen').classList.remove('hidden');
            updateHeader();
        }

        function goBack() {
            if (currentScreen === 'builder' || currentScreen === 'workout') {
                goHome();
            }
        }

        function goHome() {
            if (timer) clearInterval(timer);
            showScreen('home');
            renderWorkoutsList();
        }

        function toggleEdit() {
            editMode = !editMode;
            document.getElementById('editBtn').textContent = editMode ? 'Done' : 'Edit';
        }

        // Workout Builder
        function showBuilder() {
            builderExercises = [];
            document.getElementById('workoutName').value = '';
            document.getElementById('timerToggle').checked = true;
            document.getElementById('rhythmToggle').checked = true;
            renderBuilderExercises();
            showScreen('builder');
        }

        function editWorkout(index) {
            const workout = workouts[index];
            builderExercises = [...workout.exercises];
            document.getElementById('workoutName').value = workout.name;
            document.getElementById('timerToggle').checked = workout.timerEnabled;
            document.getElementById('rhythmToggle').checked = workout.rhythmEnabled;
            renderBuilderExercises();
            showScreen('builder');
        }

        function renderBuilderExercises() {
            const list = document.getElementById('exercisesList');
            list.innerHTML = '';
            
            builderExercises.forEach((ex, index) => {
                const item = document.createElement('div');
                item.className = 'exercise-item';
                item.innerHTML = `
                    <div class="exercise-info">
                        <div class="exercise-name">${ex.name}</div>
                        <div class="exercise-details">
                            ${ex.type === 'reps' ? `${ex.reps} reps${ex.sets ? ` √ó ${ex.sets} sets` : ''}` : `${ex.duration}s${ex.sets ? ` √ó ${ex.sets} sets` : ''}`}
                        </div>
                    </div>
                    <button class="delete-btn" onclick="removeExercise(${index})">‚àí</button>
                `;
                list.appendChild(item);
            });
        }

        function removeExercise(index) {
            builderExercises.splice(index, 1);
            renderBuilderExercises();
        }

        // Exercise Modal
        function showExerciseModal() {
            document.getElementById('exerciseModal').classList.remove('hidden');
            document.getElementById('exerciseNameInput').value = '';
            setExerciseType('reps');
            exerciseNumbers = { reps: 10, duration: 30, sets: 3, pace: 3 };
            updateNumberDisplays();
        }

        function closeExerciseModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('exerciseModal').classList.add('hidden');
        }

        function setExerciseType(type) {
            exerciseType = type;
            
            document.getElementById('repsTypeBtn').className = type === 'reps' ? 'btn-ios btn-primary-ios' : 'btn-ios btn-secondary-ios';
            document.getElementById('durationTypeBtn').className = type === 'duration' ? 'btn-ios btn-primary-ios' : 'btn-ios btn-secondary-ios';
            
            document.getElementById('repsGroup').classList.toggle('hidden', type !== 'reps');
            document.getElementById('durationGroup').classList.toggle('hidden', type !== 'duration');
            document.getElementById('paceGroup').classList.toggle('hidden', type !== 'reps');
        }

        function adjustNumber(field, delta) {
            exerciseNumbers[field] = Math.max(1, exerciseNumbers[field] + delta);
            updateNumberDisplays();
        }

        function updateNumberDisplays() {
            document.getElementById('repsDisplay').textContent = exerciseNumbers.reps;
            document.getElementById('durationDisplay').textContent = exerciseNumbers.duration;
            document.getElementById('setsDisplay').textContent = exerciseNumbers.sets;
            document.getElementById('paceDisplay').textContent = exerciseNumbers.pace;
        }

        function addExercise() {
            const name = document.getElementById('exerciseNameInput').value.trim();
            if (!name) {
                alert('Please enter an exercise name');
                return;
            }

            const sets = exerciseNumbers.sets;
            const baseExercise = {
                section: "Workout",
                name: name,
                type: exerciseType
            };

            if (exerciseType === 'reps') {
                baseExercise.reps = exerciseNumbers.reps;
                baseExercise.pace = exerciseNumbers.pace;
            } else {
                baseExercise.duration = exerciseNumbers.duration;
            }

            // Add multiple sets if needed
            if (sets > 1) {
                for (let i = 1; i <= sets; i++) {
                    builderExercises.push({
                        ...baseExercise,
                        sets: sets,
                        currentSet: i,
                        section: `Set ${i}`
                    });
                }
            } else {
                builderExercises.push(baseExercise);
            }

            renderBuilderExercises();
            closeExerciseModal();
        }

        function saveWorkout() {
            const name = document.getElementById('workoutName').value.trim();
            if (!name) {
                alert('Please enter a workout name');
                return;
            }

            if (builderExercises.length === 0) {
                alert('Please add at least one exercise');
                return;
            }

            const workout = {
                id: Date.now().toString(),
                name: name,
                timerEnabled: document.getElementById('timerToggle').checked,
                rhythmEnabled: document.getElementById('rhythmToggle').checked,
                exercises: builderExercises
            };

            workouts.push(workout);
            saveWorkouts();
            goHome();
        }

        function deleteWorkout(index) {
            if (confirm('Delete this workout?')) {
                workouts.splice(index, 1);
                saveWorkouts();
                renderWorkoutsList();
            }
        }

        // Workout Execution
        function startWorkout(index) {
            currentWorkout = workouts[index];
            currentExerciseIndex = 0;
            displayExercise();
            showScreen('workout');
        }

        function displayExercise() {
            const exercise = currentWorkout.exercises[currentExerciseIndex];
            
            document.getElementById('sectionBadge').textContent = exercise.section;
            document.getElementById('exerciseTitle').textContent = exercise.name;
            
            let subtitle = '';
            if (exercise.type === 'reps') {
                subtitle = `${exercise.reps} reps`;
                if (exercise.sets) subtitle += ` (Set ${exercise.currentSet}/${exercise.sets})`;
            } else {
                subtitle = `${exercise.duration} seconds`;
                if (exercise.sets) subtitle += ` (Set ${exercise.currentSet}/${exercise.sets})`;
            }
            document.getElementById('exerciseSubtitle').textContent = subtitle;
            
            // Timer
            if (currentWorkout.timerEnabled) {
                if (exercise.type === 'reps') {
                    timeRemaining = exercise.reps * (exercise.pace || 3);
                } else {
                    timeRemaining = exercise.duration;
                }
                document.getElementById('timerDisplay').textContent = formatTime(timeRemaining);
            } else {
                document.getElementById('timerDisplay').textContent = '--:--';
            }
            
            // Rhythm
            if (currentWorkout.rhythmEnabled && exercise.type === 'reps') {
                document.getElementById('rhythmContainer').classList.remove('hidden');
                document.getElementById('rhythmCircle').textContent = 'READY';
                document.getElementById('rhythmCircle').className = 'rhythm-circle';
                document.getElementById('repCounter').textContent = `Rep 0 / ${exercise.reps}`;
            } else {
                document.getElementById('rhythmContainer').classList.add('hidden');
            }
            
            document.getElementById('motivationText').textContent = getRandomMotivation();
            
            // Reset controls
            const buttons = document.getElementById('controlButtons');
            buttons.className = 'control-buttons single';
            buttons.innerHTML = '<button class="control-btn btn-start" onclick="startExercise()">Start</button>';
            
            updateProgress();
        }

        function startExercise() {
            const exercise = currentWorkout.exercises[currentExerciseIndex];
            currentRep = 0;
            isUp = false;
            isPaused = false;
            
            const buttons = document.getElementById('controlButtons');
            buttons.className = 'control-buttons';
            buttons.innerHTML = `
                <button class="control-btn btn-pause" onclick="pauseExercise()">Pause</button>
                <button class="control-btn btn-skip" onclick="skipExercise()">Skip</button>
            `;
            
            if (currentWorkout.timerEnabled) {
                if (exercise.type === 'reps' && currentWorkout.rhythmEnabled) {
                    startRepExercise();
                } else {
                    startTimerExercise();
                }
            } else {
                // Manual mode
                startManualMode();
            }
        }

        function startRepExercise() {
            const exercise = currentWorkout.exercises[currentExerciseIndex];
            const repTime = exercise.pace || 3;
            const halfRepTime = repTime / 2;
            let elapsed = 0;
            
            timer = setInterval(() => {
                if (isPaused) return;
                
                elapsed += 0.1;
                timeRemaining = Math.max(0, exercise.reps * repTime - elapsed);
                document.getElementById('timerDisplay').textContent = formatTime(Math.ceil(timeRemaining));
                
                const currentRepProgress = elapsed % repTime;
                
                if (currentRepProgress < halfRepTime) {
                    if (!isUp) {
                        isUp = true;
                        currentRep++;
                        document.getElementById('repCounter').textContent = `Rep ${currentRep} / ${exercise.reps}`;
                        updateMotivation();
                    }
                    document.getElementById('rhythmCircle').textContent = 'UP ‚¨ÜÔ∏è';
                    document.getElementById('rhythmCircle').className = 'rhythm-circle up';
                } else {
                    isUp = false;
                    document.getElementById('rhythmCircle').textContent = 'DOWN ‚¨áÔ∏è';
                    document.getElementById('rhythmCircle').className = 'rhythm-circle down';
                }
                
                if (timeRemaining <= 0) {
                    completeExercise();
                }
            }, 100);
        }

        function startTimerExercise() {
            timer = setInterval(() => {
                if (isPaused) return;
                
                timeRemaining--;
                document.getElementById('timerDisplay').textContent = formatTime(timeRemaining);
                
                if (timeRemaining % 10 === 0) {
                    updateMotivation();
                }
                
                if (timeRemaining <= 0) {
                    completeExercise();
                }
            }, 1000);
        }

        function startManualMode() {
            const buttons = document.getElementById('controlButtons');
            buttons.className = 'control-buttons single';
            buttons.innerHTML = '<button class="control-btn btn-start" onclick="completeExercise()">Done</button>';
        }

        function pauseExercise() {
            isPaused = !isPaused;
            const pauseBtn = document.querySelector('.btn-pause');
            if (pauseBtn) {
                pauseBtn.textContent = isPaused ? 'Resume' : 'Pause';
            }
        }

        function skipExercise() {
            if (timer) clearInterval(timer);
            nextExercise();
        }

        function completeExercise() {
            if (timer) clearInterval(timer);
            
            document.getElementById('rhythmCircle').textContent = '‚úì';
            document.getElementById('rhythmCircle').className = 'rhythm-circle up';
            
            setTimeout(() => {
                nextExercise();
            }, 800);
        }

        function nextExercise() {
            currentExerciseIndex++;
            
            if (currentExerciseIndex >= currentWorkout.exercises.length) {
                showCompletion();
            } else {
                displayExercise();
            }
        }

        function showCompletion() {
            document.getElementById('totalTime').textContent = `${calculateWorkoutTime(currentWorkout)} min`;
            document.getElementById('totalExercises').textContent = currentWorkout.exercises.length;
            showScreen('completion');
        }

        // Utilities
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function getRandomMotivation() {
            return motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
        }

        function updateMotivation() {
            const exercise = currentWorkout.exercises[currentExerciseIndex];
            const motivationText = document.getElementById('motivationText');
            
            if (exercise.type === 'reps' && currentRep === Math.floor(exercise.reps / 2)) {
                motivationText.textContent = "üí™ Halfway there!";
            } else if (exercise.type === 'reps' && currentRep === exercise.reps - 3) {
                motivationText.textContent = "üî• Last 3 reps!";
            } else if (timeRemaining <= 10 && timeRemaining > 5) {
                motivationText.textContent = "‚ö° Final 10 seconds!";
            } else {
                motivationText.textContent = getRandomMotivation();
            }
        }

        function updateProgress() {
            const progress = (currentExerciseIndex / currentWorkout.exercises.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressPercentage').textContent = Math.round(progress) + '%';
        }

        // Initialize app
        init();
    </script>
</body>
</html>
